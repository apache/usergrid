<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Apache Usergrid (incubating) — Managing access by defining permission rules</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" />
    <meta name="keywords" content="Apache Usergrid, Usergrid, BaaS, Backend-as-a-Service">
    <meta name="description" content="An open-source Backend-as-a-Service stack for web & mobile applications, based on RESTful APIs." />
    <meta property="og:title" content="Apache Usergrid" />
    <meta property="og:description" content="An open-source Backend-as-a-Service stack for web & mobile applications, based on RESTful APIs." />
    <!-- Loading Typekit -->
    <script type="text/javascript" src="//use.typekit.net/ddl7izx.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
    <!-- Loading Bootstrap -->
    <link href="/bootstrap/bootstrap.min.css" rel="stylesheet" type='text/css'>
    <link href="/css/bootflat.css" rel="stylesheet" type='text/css'>
    <link href="/css/usergrid-site.css" rel="stylesheet" type='text/css'>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:200,400,500,300,600,800,700,400italic,600italic,700italic,800italic,300italic" rel="stylesheet" type="text/css">
    <link href="/css/font-awesome.min.css" rel="stylesheet" type='text/css'>

    

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements. All other JS at the end of file. -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
      <script src="js/respond.min.js"></script>
    <![endif]-->
</head>
<body>

    <header class="navbar navbar-inverse navbar-fixed-top bf-docs-nav secondary" role="banner">
    <div class="container">
        <div class="navbar-header">
            <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bf-navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>
        <a href="/" class="navbar-brand">
                <img id="home-logo" src="/img/apache_usergrid_logo_white_small.png" />
            </a>
        <nav class="collapse navbar-collapse bf-navbar-collapse" role="navigation">
            <ul class="nav navbar-nav navbar-right">
                <li class=""><a href="/community/"><span class="icns icon-group"></span></a></li>
                <li><a href="http://usergrid.readthedocs.org/" target="_blank"><span class="icns icon-book"></span></a></li>
                <li><a href="http://github.com/apache/incubator-usergrid" target="_blank"><span class="icns icon-github-sign"></span></a></li>
                <!--<li><a href="https://trello.com/b/exQmJIOn/usergrid" target="_blank"><span class="icns icon-trello"></span></a></li>-->
                <li><a href="https://issues.apache.org/jira/secure/RapidBoard.jspa?rapidView=23&view=planning&selectedIssue=USERGRID-362&epics=visible" target="_blank"><span class="icns icon-bug"></span></a></li>
                <li><a href="http://stackoverflow.com/search?q=usergrid" target="_blank"><span class="icns icon-stackexchange"></span></a></li>
                <li><a href="/community/#live"><span class="icns icon-comments"></span></a></li>
                <!--<li><a href="https://groups.google.com/forum/#!forum/usergrid" target="_blank"><span class="icns icon-envelope"></span></a></li>-->
                <li><a href="https://twitter.com/usergrid" target="_blank"><span class="icns icon-twitter"></span></a></li>
                <li><a href="https://cwiki.apache.org/confluence/display/usergrid/" target="_blank"><span class="icns icon-wiki"></span></a></li>
                <li><a href="/releases/"><span class="icns icon-releases"></span></a></li>
            </ul>
        </nav>
    </div>
    </header>



<div class="container bf-docs-container">    
    <div class="row">
        <div class="col-md-3">
            <div class="bf-sidebar hidden-print" role="complementary">
                <ul class="nav nav-list">
                    <li><a href="/docs/getting-up-and-running-locally/">Getting Up &amp; Running Locally</a></li>
                    <li><a href="/docs/deploy-local/">Deploying to local Tomcat &amp; Cassandra</a></li>
                    <li><a href="https://github.com/apache/incubator-usergrid/tree/master/ugc#usergrid-command-line-ugc"><code>ugc</code> — the Command-line Client</a></li>

                    <li class="nav-header"><span>Concepts</span></li>
                    <li>
                        <a href="/docs/organizations-admins/">Organizations & Admins</a>
                        <ul>
                            <li>
                                <a href="/docs/applications/">Applications</a>
                                <ul>
                                    <li><a href="/docs/roles-and-permissions/">Roles & Permissions</a></li>
                                    <!--<li><a href="#">Queues</a></li>-->
                                    <li><a href="/docs/events-and-counters/">Events & Counters</a></li>
                                    <li><a href="/docs/relationships/">Relationships (Joins)</a></li>
                                    <li>
                                        <a href="/docs/collections">Collections</a>
                                        <ul>
                                            <li><a href="/docs/query-language/">Query Language</a></li>
                                            <li><a href="/docs/users-devices/">Users & Devices</a></li>
                                            <li><a href="/docs/groups/">Groups</a></li>
                                            <li><a href="/docs/activities/">Activities</a></li>
                                            <li><a href="/docs/assets/">Assets</a></li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </li>


                    <li class="nav-header"><span>Usage</span></li>
                    <!-- <li>REST API — Coming Soon</li> -->
                    <li><a class="icns-apple" href="https://github.com/apache/incubator-usergrid/tree/master/sdks/ios">iOS SDK</a></li>
                    <li><a class="icns-android" href="https://github.com/apache/incubator-usergrid/tree/master/sdks/android">Android SDK</a></li>
                    <li><a class="icns-html5" href="">HTML5 / JavaScript SDK</a></li>
                    <li><a class="icns-windows" href="https://github.com/apache/incubator-usergrid/tree/master/sdks/dotnet">Windows 8 / Windows Phone / .net SDK</a></li>
                    <li><a href="https://github.com/apache/incubator-usergrid/tree/master/sdks/nodejs">Node.js module</a></li>
                    <li><a href="https://github.com/apache/incubator-usergrid/tree/master/sdks/ruby">Ruby gem</a></li>
                    <li><a href="https://github.com/apache/incubator-usergrid/tree/master/sdks/ruby-on-rails">Ruby on Rails gem</a></li>
                    <li><a href="https://github.com/apache/incubator-usergrid/tree/master/sdks/php">PHP library</a></li>
                    <li><a href="https://github.com/apache/incubator-usergrid/tree/master/sdks/java">Java library</a></li>

                    <!--<li class="nav-header"><span>Internals</span></li>
                    <li>Design & Goals — Coming Soon</li>
                    <li>Java Architecture — Coming Soon</li>
                    <li>Cassandra Schema — Coming Soon</li>-->

                    <li class="nav-header"><span>Operations</span></li>
                    <!--<li>Deploying — Coming Soon</li>-->
                    <!-- <li>Monitoring — Coming Soon</li> -->
                    <li><a href="/docs/upgrading/">Upgrading</a></li>
                    <!-- <li>Security — Coming Soon</li> -->

                    <li class="nav-header"><span>Presentations & Videos</span></li>
                    <li><a href="/docs/presentations/">Presentations</a></li>
                    <li><a href="/docs/videos/">Videos</a></li>

                    <li class="nav-header"><span>We need your help!</span></li>
                    <li><a href="/docs/contribute-code/">How to Contribute Code & Docs</a></li>
                    <!--
                    <li><a href="/docs/contribute-docs">How to contribute docs</a></li>
                    -->
                </ul>
            </div>
        </div>

        <div class="col-md-9 main-article" role="main">
            <div class="page-article">
                <div class="page-header">
                    <h1>Managing access by defining permission rules</h1>
                    <!-- TODO: reenable this when we sync SVN to GitHub
                  <small><a target="_blank" href="https://github.com/usergrid/website/blob/master/content/docs/managing-access-defining-permission-rules.md">contribute to this article on github</a></small>
                    -->
                </div>
                <div class="toc">
	<ul>
<li>
<a href="#managing-access-by-defining-permission-rules">Managing access by defining permission rules</a><ul>
<li><a href="#roles-included-by-default">Roles included by default</a></li>
<li><a href="#defining-your-own-roles-andpermissions">Defining your own roles and permissions</a></li>
<li><a href="#permission-rule-examples">Permission rule examples</a></li>
</ul>
</li>
</ul>
</div>
<h1 id="managing-access-by-defining-permission-rules">Managing access by defining permission rules</h1>
<p>You control your app users’ access to application resources by defining roles and permission rules. In your Apache Usergrid application, you assign application users a <em>role</em> that represents a set of permissions. Through these permissions, you allow users to perform certain operations (GET, POST, PUT, or DELETE) on specific resources. When the user submits a request via your app code to the Apache Usergrid API, the user’s permissions are checked against the resource paths that the user is trying to access. The request succeeds only if access to the resource is allowed by the permission rules you specify.</p>
<p>You specify roles for unauthenticated users and those who authenticate as an Application User, as defined in <a href="/authenticating-users-and-application-clients">Authenticating users and application clients</a>. Roles are not applied for the other authentication levels: Application, Admin User, and Organization. Access at these levels can’t be restricted by roles and permission rules. You should allow clients to authenticate at these levels sparingly and carefully.</p>
<h2 id="roles-included-by-default">Roles included by default</h2>
<p>When defining user access to your application’s data, you create roles, specify permission rules for them, then associate users with the roles. Apache Usergrid includes three predefined roles when you create an application.</p>
<p>The following table lists the three roles included by default. Note that two of these are in effect and applied from the time your application is created (until you change them). Apache Usergrid applies the following default behavior:</p>
<ol style="list-style-type: decimal">
<li>An unauthenticated user is automatically added to the Guest role so that they can register for a user account.</li>
<li>A user who has a user account and authenticates with it is automatically added to the Default role. <strong>Note that by default, this role is very permissive.</strong> Be sure to restrict it with specific permission rules before deploying to production.</li>
</ol>
<table>
<col width="33%">
<col width="33%">
<col width="33%">
<thead>
<tr class="header">
<th align="left">Role</th>
<th align="left">Description</th>
<th align="left">Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>Guest</p></td>
<td align="left"><p>Default for unauthenticated users. Includes a basic set of permissions for unregistered or unauthenticated users. Users are automatically added to the Guest role before they’re authenticated. After they’re authenticated, users are automatically added to the Default role.</p></td>
<td align="left"><p>Grants permission for a user to create a user account and for their device to be registered. You can change permission rules based on your goals for unregistered user access. This role is designed to provide access for people who haven’t yet registered, and allow them to register.</p></td>
</tr>
<tr class="even">
<td align="left"><p>Default</p></td>
<td align="left"><p>Default for authenticated users. Includes permissions for the set of operations you want an authenticated user to be able to perform. Users are added to this role after they’re authenticated.</p></td>
<td align="left"><p>By default, <strong>grants full access for all resources in your application</strong>. A first task in securing your application should be to restrict access by redefining this role to narrow the access it provides. Remove the default full permission rule and add restrictive permission rules for a production deployment.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Administrator</p></td>
<td align="left"><p>Unused until you associate it with users or groups. By default, includes no permissions that provide access.</p></td>
<td align="left">
<p>Grants no access. Consider this a blank slate. Add permission rules and associate this role with users and groups as needed.</p>
<p><strong>Note</strong>: The Administrator role is <em>not the same</em> as an organization administrator – that is, someone who authenticates as an Admin User. The Admin User is an implicit user created when you create an organization. After authenticating, the Admin User has full access to all of the administration features of the Apache Usergrid API. By comparison, the Administrator role is simply a role (initially without permissions) that can be assigned to any user.</p>
</td>
</tr>
</tbody>
</table>
<h2 id="defining-your-own-roles-andpermissions">Defining your own roles and permissions</h2>
<p>When preparing an application for production use, a good first step is to edit permission rules for the Default role. This role will be applied for every user who authenticates as an Application User.</p>
<p>The admin portal is the best place to manage roles. While you can manage roles and permissions programmatically (see <a href="/role">Role</a>), security-related calls from a mobile app will pose a security risk. Consider doing so only from a server-side web application.</p>
<p>For easy-to-read examples, this section expresses permission rules in this way:</p>
<pre><code>&lt;operations&gt;:&lt;entity path pattern&gt;</code></pre>
<ul>
<li>&lt;operations&gt; is a comma-delimited set of REST operations (GET, PUT, POST, DELETE) that are allowed for the specified entity path.</li>
<li>&lt;entity path pattern&gt; is a parameter evaluated using Apache Ant pattern matching (see <a href="http://ant.apache.org/manual/dirtasks.html#patterns">http://ant.apache.org/manual/dirtasks.html#patterns</a>).</li>
</ul>
<p>For example, in the Default role, first remove the permission rule that grants full access to all authenticated users. You could then begin by creating a rule that grants access for the authenticated user to makes changes only to data associated with their account. </p>
<pre><code>GET,PUT,POST,DELETE:/users/me/**</code></pre>
<p>Use the Admin Portal to make role and permission rule changes. On the left sidebar of the portal, click Users, then click Roles. This displays the roles defined for the application. To create a role, click the Add button (it looks like a person’s silhouette). To delete a role, select the role you want to delete and click the Remove button (it looks like a trash can). To view the privileges in a role, click the role.</p>
<p>Suppose you created a role named “customer”. Here’s what the privileges for the role might look like:</p>
<div class="figure">
<img src="/docs/sites/docs/files/worker_permissions.png">
</div>
<p>Notice that specific privileges for operations are represented using checkboxes in the Permission Rules section. The path indicates the resource path for which the permissions apply. The permissions apply to all resources in the specified path directory and its subdirectories. As currently specified, the worker role has GET permission on the base directory path (/) and all resource paths below it (in other words, all resource paths).</p>
<p>You can add a permission, by entering the entity path pattern in the Path field of the Add Permission Rule section, and checking the operation checkboxes (get, post, put, and delete) as appropriate. For example, the following adds permission to create a user:</p>
<div class="figure">
<img src="/docs/sites/docs/files/add_permission.png">
</div>
<p>Click Add, and the permission is added to the role.</p>
<div class="figure">
<img src="/docs/sites/docs/files/pemission_list.png">
</div>
<h2 id="permission-rule-examples">Permission rule examples</h2>
<p>Here are some examples to illustrate how permissions are specified:</p>
<ul>
<li><p>Authenticated user can change any data related to the:<br> POST:/users/*</p></li>
<li><p>A permission the permits the current user to make any changes to resources associated with them:<br> GET,PUT,POST,DELETE:/users/me/**</p></li>
<li><p>A permission that allows someone to look at a specific user:<br> GET:/users/john.doe</p></li>
<li>
<p>A permission that allows the current user to see his activity feed:<br> GET:/users/${user}/feed/*</p>
<p>The ${user} in the entity path refers to a variable that represents the current user’s UUID.</p>
</li>
<li>
<p>A permission allowing linked entities to be read:<br> GET:/users/${user}/**</p>
<p>The /** in the entity path is a wildcard that matches everything under that path. This means that the full specification matches multiple resource paths, including, but not limited to, the following:</p>
<pre><code>/users/${user}/feed
/users/${user}/feed/item1/a/b/c</code></pre>
</li>
<li><p>A permission that allows the current user to add himself or another user to a group:<br> POST:/groups/${user}/users/**</p></li>
</ul>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-3"></div>
        <div class="col-md-9">
            <div class="github-callout">
                <strong>Questions?</strong> Please do <a href="/community">ask on the mailing-lists</a>!<br/>
                <!--
                <strong>Found an error?</strong> We’d greatly appreciate a pull request about <a target="_blank" href="https://github.com/usergrid/website/blob/master/content/docs/managing-access-defining-permission-rules.md">this article on github</a>.</div> 
                -->
            </div>
        </div>
    </div>
</div>


<footer class="bf-footer" role="contentinfo">
    <div class="container">
        <div class="row">
            <div class="col-md-2">
                <ul class="nav nav-list">
                    <li class="nav-header"><a href="/">Home</a></li>
                    <li class="nav-header"><a href="/community/">Community</a></li>
                        <li><a href="/community/#events">Events</a></li>
                        <li><a href="/community/#mailing-lists">Mailing Lists</a></li>
                        <li><a href="/community/#deployments">Deployments</a></li>
                        <li><a href="/community/#committers">Commiters</a></li>
                </ul>
            </div>
            <div class="col-md-2">
                <ul class="nav nav-list">
                    <li class="nav-header"><a href="https://github.com/apache/incubator-usergrid/" target="_blank">Code</a></li>
                    <li><a href="https://github.com/apache/incubator-usergrid/blob/master/stack" target="_blank">Server Stack</a></li>
                    <li><a href="https://github.com/apache/incubator-usergrid/blob/master/portal" target="_blank">Admin Portal</a></li>
                    <li><a href="https://github.com/apache/incubator-usergrid/blob/master/ugc" target="_blank">ugc command line</a></li>
                    <li><a href="https://github.com/apache/incubator-usergrid/blob/master/sdks/ios" target="_blank">iOS SDK</a></li>
                    <li><a href="https://github.com/apache/incubator-usergrid/blob/master/sdks/android" target="_blank">Android SDK</a></li>
                    <li><a href="https://github.com/apache/incubator-usergrid/blob/master/sdks/html5-javascript" target="_blank">HTML5/JS SDK</a></li>
                    <li><a href="https://github.com/apache/incubator-usergrid/blob/master/sdks/nodejs" target="_blank">node.js module</a></li>
                    <li><a href="https://github.com/apache/incubator-usergrid/blob/master/sdks/ruby-on-rails" target="_blank">Ruby on Rails gem</a></li>
                    <li><a href="https://github.com/apache/incubator-usergrid/blob/master/sdks/ruby" target="_blank">Ruby gem</a></li>
                    <li><a href="https://github.com/apache/incubator-usergrid/blob/master/sdks/php" target="_blank">PHP SDK</a></li>
                    <li><a href="https://github.com/apache/incubator-usergrid/blob/master/sdks/java" target="_blank">Java SDK</a></li>
                    <li><a href="https://github.com/apache/incubator-usergrid/blob/master/sdks/dotnet" target="_blank">.NET / Windows SDK</a></li>
                </ul>
            </div>
            <div class="col-md-2">
                <ul class="nav nav-list">
                    <li class="nav-header">Resources</li>
                    <li><a href="http://github.com/apache/incubator-usergrid" target="_blank">GitHub Code</a></li>
                    <li><a href="http://usergrid.readthedocs.org/" target="_blank">Docs</a></li>
                    <li><a href="https://issues.apache.org/jira/secure/RapidBoard.jspa?rapidView=23&view=planning&selectedIssue=USERGRID-362&epics=visible" target="_blank">JIRA Bug Tracker</a></li>
                    <li><a href="http://stackoverflow.com/search?q=usergrid" target="_blank">StackOverflow</a></li>
                    <li><a href="/community/#live">Live Chat</a></li>
                    <li><a href="https://twitter.com/usergrid" target="_blank">Twitter</a></li>
                    <li><a href="http://incubator.apache.org/projects/usergrid.html" target="_blank">Podling Listing</a></li>
                    <li><a href="https://github.com/apache/incubator-usergrid/blob/master/stack#requirements" target="_blank">Getting Started</a></li>
                    <li><a href="https://cwiki.apache.org/confluence/display/usergrid/GitHub+Based+Contribution+Workflow" target="_blank">Contribution Guidelines</a></li>
                </ul>
            </div>
            <div class="col-md-2">
                <ul class="nav nav-list">
                    <li class="nav-header">Apache</li>
                    <li><a href="http://www.apache.org/licenses/" target="_blank">License</a></li>
                    <li><a href="http://www.apache.org/foundation/sponsorship.html" target="_blank">Sponsorship</a></li>
                    <li><a href="http://www.apache.org/foundation/thanks.html" target="_blank">Thanks</a></li>
                    <li><a href="http://www.apache.org/security/">Security</a></li>
                    <li><a href="http://www.apache.org/" target="_blank">Apache Foundation</a></li>
                </ul>
            </div>
            <div class="col-md-4">
                <a class="twitter-timeline" href="https://twitter.com/search?q=%23usergrid" data-widget-id="401499136807038976"  data-related="usergrid" height="400px" style="overflow:hidden">Tweets about "usergrid"</a>
                <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
            </div> 
        <!--
            <div class="col-md-4">
                <div class="input-group form-search">
                    <input type="text" class="form-control search-query">
                    <span class="input-group-btn">
                        <button type="submit" class="btn btn-primary" data-type="last">Search</button>
                    </span>
                </div>
            </div> -->
        </div> 
        <div class="row">
            <div id="copyright">
                <img src="/img/egg-logo.png" /><br/><br/>
                <p>Apache Usergrid is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator PMC. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.</p>
                <p>Copyright © 2013 The Apache Software Foundation, Licensed under the Apache License, Version 2.0.<br>
                Apache and the Apache feather logos are trademarks of The Apache Software Foundation.</p>
                <p class="credits">Site designed & assembled with love by <a href="https://github.com/ryuneeee">@ryuneeee</a> + <a href="https://github.com/realbeast">@realbeast</a> + <a href="https://twitter.com/timanglade">@timanglade</a>.</p>
            </div>
        </div>
    </div>
</footer>

<script type="text/javascript" src="/js/head.js"></script>
<script type="text/javascript">
    head.js("/js/jquery-1.10.1.min.js", "/js/bootstrap.min.js", "/js/usergrid-site.js");
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45815079-1', 'apache.org');
  ga('send', 'pageview');

</script>



</body>
</html>
